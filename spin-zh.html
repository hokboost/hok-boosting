<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>抽奖转盘</title>
  <style>
    body { text-align: center; background: #222; color: white; font-family: sans-serif; }
    #wheel {
      width: 300px; height: 300px; border-radius: 50%;
      border: 8px solid white; position: relative;
      transition: transform 5s cubic-bezier(0.25, 0.1, 0.25, 1);
    }
    #pointer {
      width: 0; height: 0; border-left: 15px solid transparent;
      border-right: 15px solid transparent; border-bottom: 30px solid black;
      position: absolute; top: -30px; left: calc(50% - 15px); z-index: 10;
    }
    #password { font-size: 18px; margin-top: 10px; }
    #result { margin-top: 20px; font-size: 22px; color: gold; }
  </style>
</head>
<body>
  <h1>幸运大转盘</h1>
  <div id="pointer"></div>
  <canvas id="wheel" width="300" height="300"></canvas>
  <br>
  <input type="text" id="password" placeholder="请输入密码">
  <button onclick="spin()">开始抽奖</button>
  <div id="result"></div>

  <script>
    const prizes = ['谢谢参与', '-5元优惠', '免费一局', '再来一次', '9折优惠', '当天免费'];
    const colors = ['#666', '#4caf50', '#ff9800', '#2196f3', '#e91e63', '#ffd700'];
    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");

    function drawWheel() {
      const angle = 2 * Math.PI / prizes.length;
      for (let i = 0; i < prizes.length; i++) {
        ctx.beginPath();
        ctx.fillStyle = colors[i];
        ctx.moveTo(150, 150);
        ctx.arc(150, 150, 150, i * angle, (i + 1) * angle);
        ctx.fill();
        ctx.fillStyle = "#fff";
        ctx.font = "14px sans-serif";
        ctx.translate(150, 150);
        ctx.rotate(angle / 2 + i * angle);
        ctx.fillText(prizes[i], 70, 0);
        ctx.rotate(-angle / 2 - i * angle);
        ctx.translate(-150, -150);
      }
    }

    let currentRotation = 0;
    drawWheel();

    function spin() {
      const password = document.getElementById("password").value.trim();
      if (!password) return alert("请输入密码");

      fetch("https://hokboost.ngrok.io/spin", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ key: password })
      })
      .then(res => res.json())
      .then(data => {
        if (!data.success) {
          document.getElementById("result").textContent = "❌ " + data.message;
          return;
        }

        const angle = data.angle;
        currentRotation += 360 * 10; // 保证转几圈
        const finalRotation = currentRotation + (360 - (angle % 360));
        canvas.style.transform = `rotate(${finalRotation}deg)`;

        setTimeout(() => {
          document.getElementById("result").textContent = "🎉 恭喜获得：" + data.prize;
        }, 5200);
      });
    }
  </script>
</body>
</html>


